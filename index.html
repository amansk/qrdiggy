<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QRDiggy — Dead Simple QR Codes</title>
<meta name="description" content="Free QR code generator. No signup. No nonsense. Just paste a URL and get your QR code.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,500;0,9..40,700;1,9..40,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0c;
    --surface: #141418;
    --surface-hover: #1c1c22;
    --border: #2a2a32;
    --text: #e8e8ec;
    --text-dim: #8888a0;
    --accent: #f0c040;
    --accent-glow: rgba(240, 192, 64, 0.15);
    --accent-hover: #f5d060;
    --radius: 12px;
    --radius-lg: 20px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(240, 192, 64, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(240, 192, 64, 0.03) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 520px;
    padding: 24px 20px 48px;
  }

  .header {
    text-align: center;
    padding: 48px 0 40px;
  }

  .logo {
    font-family: 'Space Mono', monospace;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: -1px;
    color: var(--text);
  }

  .logo span { color: var(--accent); }

  .tagline {
    color: var(--text-dim);
    font-size: 0.95rem;
    margin-top: 8px;
    font-weight: 300;
    letter-spacing: 0.5px;
  }

  .input-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 20px;
    transition: border-color 0.3s;
  }

  .input-section:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 4px var(--accent-glow);
  }

  .input-label {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-dim);
    margin-bottom: 12px;
    display: block;
  }

  .url-input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 0.9rem;
    outline: none;
    transition: all 0.2s;
  }

  .url-input::placeholder { color: #555566; }

  .url-input:focus {
    border-color: var(--accent);
    background: #0d0d10;
  }

  .options-row {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }

  .option-group { flex: 1; }

  .option-group label {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-dim);
    margin-bottom: 6px;
    display: block;
  }

  .color-picker-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 8px 12px;
  }

  .color-picker-wrap input[type="color"] {
    -webkit-appearance: none;
    border: none;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    cursor: pointer;
    background: none;
  }

  .color-picker-wrap input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
  .color-picker-wrap input[type="color"]::-webkit-color-swatch {
    border: 2px solid var(--border);
    border-radius: 6px;
  }

  .color-hex {
    font-family: 'Space Mono', monospace;
    font-size: 0.8rem;
    color: var(--text-dim);
  }

  .btn-generate {
    width: 100%;
    margin-top: 16px;
    padding: 14px 24px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: var(--radius);
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.5px;
  }

  .btn-generate:hover {
    background: var(--accent-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 20px var(--accent-glow);
  }

  .btn-generate:active { transform: translateY(0); }

  /* ── OUTPUT ── */
  .output-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 32px 24px;
    text-align: center;
    display: none;
    animation: fadeUp 0.4s ease;
  }

  .output-section.visible { display: block; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .qr-preview-wrap {
    display: inline-block;
    padding: 16px;
    background: white;
    border-radius: var(--radius);
    margin-bottom: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }

  /* Full-res canvas is hidden; we show a scaled-down preview */
  #qrCanvas {
    display: none;
  }

  .qr-preview-wrap img {
    display: block;
    width: 180px;
    height: 180px;
    image-rendering: pixelated;
  }

  .qr-url-display {
    font-family: 'Space Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-dim);
    margin-bottom: 20px;
    word-break: break-all;
    padding: 0 12px;
  }

  .btn-row { display: flex; gap: 10px; }

  .btn-download {
    flex: 1;
    padding: 12px 20px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: var(--radius);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-download:hover {
    background: var(--accent-hover);
    transform: translateY(-1px);
  }

  .btn-transparent {
    flex: 1;
    padding: 12px 20px;
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-transparent:hover {
    background: var(--surface-hover);
    border-color: var(--text-dim);
  }

  .footer {
    text-align: center;
    padding: 40px 0 24px;
    color: var(--text-dim);
    font-size: 0.8rem;
  }

  .footer a { color: var(--accent); text-decoration: none; }


  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--surface);
    border: 1px solid var(--accent);
    color: var(--text);
    padding: 12px 24px;
    border-radius: var(--radius);
    font-size: 0.85rem;
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 100;
    pointer-events: none;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  @media (max-width: 480px) {
    .container { padding: 16px 16px 32px; }
    .header { padding: 32px 0 28px; }
    .logo { font-size: 1.6rem; }
    .btn-row { flex-direction: column; }
    .qr-preview-wrap img { width: 150px; height: 150px; }
  }
</style>
</head>
<body>

<div class="container">
  <header class="header">
    <div class="logo">QR<span>Diggy</span></div>
    <p class="tagline">Dead simple QR codes. Free. No signup.</p>
  </header>

  <section class="input-section">
    <span class="input-label">Paste your URL</span>
    <input 
      type="url" 
      class="url-input" 
      id="urlInput" 
      placeholder="https://your-link-here.com"
      autocomplete="off"
      spellcheck="false"
    >

    <div class="options-row">
      <div class="option-group">
        <label>QR Color</label>
        <div class="color-picker-wrap">
          <input type="color" id="colorPicker" value="#000000">
          <span class="color-hex" id="colorHex">#000000</span>
        </div>
      </div>
    </div>

    <button class="btn-generate" id="btnGenerate">Generate QR Code</button>
  </section>

  <!-- Hidden full-res canvas for downloads -->
  <canvas id="qrCanvas" width="512" height="512"></canvas>

  <section class="output-section" id="outputSection">
    <div class="qr-preview-wrap">
      <img id="qrPreview" alt="QR Code" />
    </div>
    <p class="qr-url-display" id="qrUrlDisplay"></p>
    <div class="btn-row">
      <button class="btn-download" id="btnDownloadPng">↓ Download PNG</button>
      <button class="btn-transparent" id="btnDownloadTransparent">↓ Transparent</button>
    </div>
  </section>

  <footer class="footer">
    <p>Built with ☕ by <a href="#">QRDiggy</a></p>
  </footer>
</div>

<div class="toast" id="toast"></div>

<script>
  // ── QR Code generator library (Project Nayuki, MIT License) ──
  // https://www.nayuki.io/page/qr-code-generator-library
  "use strict";var qrcodegen=(()=>{var d=Object.defineProperty;var g=(o,e,t)=>e in o?d(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var s=(o,e,t)=>g(o,typeof e!="symbol"?e+"":e,t);var qrcodegen;((n)=>{const r=class r{constructor(e,t,i,a){this.version=e;this.errorCorrectionLevel=t;s(this,"size");s(this,"mask");s(this,"modules",[]);s(this,"isFunction",[]);if(e<r.MIN_VERSION||e>r.MAX_VERSION)throw new RangeError("Version value out of range");if(a<-1||a>7)throw new RangeError("Mask value out of range");this.size=e*4+17;let l=[];for(let c=0;c<this.size;c++)l.push(!1);for(let c=0;c<this.size;c++){this.modules.push(l.slice());this.isFunction.push(l.slice())}this.drawFunctionPatterns();const h=this.addEccAndInterleave(i);this.drawCodewords(h);if(a==-1){let c=1e9;for(let p=0;p<8;p++){this.applyMask(p);this.drawFormatBits(p);const f=this.getPenaltyScore();f<c&&(a=p,c=f);this.applyMask(p)}}u(0<=a&&a<=7);this.mask=a;this.applyMask(a);this.drawFormatBits(a);this.isFunction=[]}static encodeText(e,t){const i=n.QrSegment.makeSegments(e);return r.encodeSegments(i,t)}static encodeBinary(e,t){const i=n.QrSegment.makeBytes(e);return r.encodeSegments([i],t)}static encodeSegments(e,t,i=1,a=40,l=-1,h=!0){if(!(r.MIN_VERSION<=i&&i<=a&&a<=r.MAX_VERSION)||l<-1||l>7)throw new RangeError("Invalid value");let c,p;for(c=i;;c++){const w=r.getNumDataCodewords(c,t)*8,v=b.getTotalBits(e,c);if(v<=w){p=v;break}if(c>=a)throw new RangeError("Data too long")}for(const w of[r.Ecc.MEDIUM,r.Ecc.QUARTILE,r.Ecc.HIGH])h&&p<=r.getNumDataCodewords(c,w)*8&&(t=w);let f=[];for(const w of e){m(w.mode.modeBits,4,f);m(w.numChars,w.mode.numCharCountBits(c),f);for(const v of w.getData())f.push(v)}u(f.length==p);const y=r.getNumDataCodewords(c,t)*8;u(f.length<=y);m(0,Math.min(4,y-f.length),f);m(0,(8-f.length%8)%8,f);u(f.length%8==0);for(let w=236;f.length<y;w^=236^17)m(w,8,f);let x=[];for(;x.length*8<f.length;)x.push(0);return f.forEach((w,v)=>x[v>>>3]|=w<<7-(v&7)),new r(c,t,x,l)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}drawFunctionPatterns(){for(let e=0;e<this.size;e++){this.setFunctionModule(6,e,e%2==0);this.setFunctionModule(e,6,e%2==0)}this.drawFinderPattern(3,3);this.drawFinderPattern(this.size-4,3);this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let i=0;i<t;i++)for(let a=0;a<t;a++)i==0&&a==0||i==0&&a==t-1||i==t-1&&a==0||this.drawAlignmentPattern(e[i],e[a]);this.drawFormatBits(0);this.drawVersion()}drawFormatBits(e){const t=this.errorCorrectionLevel.formatBits<<3|e;let i=t;for(let a=0;a<10;a++)i=i<<1^(i>>>9)*1335;const a=(t<<10|i)^21522;u(a>>>15==0);for(let l=0;l<=5;l++)this.setFunctionModule(8,l,R(a,l));this.setFunctionModule(8,7,R(a,6));this.setFunctionModule(8,8,R(a,7));this.setFunctionModule(7,8,R(a,8));for(let l=9;l<15;l++)this.setFunctionModule(14-l,8,R(a,l));for(let l=0;l<8;l++)this.setFunctionModule(this.size-1-l,8,R(a,l));for(let l=8;l<15;l++)this.setFunctionModule(8,this.size-15+l,R(a,l));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;const t=this.version<<12|e;u(t>>>18==0);for(let i=0;i<18;i++){const a=R(t,i),l=this.size-11+i%3,h=Math.floor(i/3);this.setFunctionModule(l,h,a);this.setFunctionModule(h,l,a)}}drawFinderPattern(e,t){for(let i=-4;i<=4;i++)for(let a=-4;a<=4;a++){const l=Math.max(Math.abs(a),Math.abs(i)),h=e+a,c=t+i;0<=h&&h<this.size&&0<=c&&c<this.size&&this.setFunctionModule(h,c,l!=2&&l!=4)}}drawAlignmentPattern(e,t){for(let i=-2;i<=2;i++)for(let a=-2;a<=2;a++)this.setFunctionModule(e+a,t+i,Math.max(Math.abs(a),Math.abs(i))!=1)}setFunctionModule(e,t,i){this.modules[t][e]=i;this.isFunction[t][e]=!0}addEccAndInterleave(e){const t=this.version,i=this.errorCorrectionLevel;if(e.length!=r.getNumDataCodewords(t,i))throw new RangeError("Invalid argument");const a=r.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][t],l=r.ECC_CODEWORDS_PER_BLOCK[i.ordinal][t],h=Math.floor(r.getNumRawDataModules(t)/8),c=a-h%a,p=Math.floor(h/a);let f=[];const y=r.reedSolomonComputeDivisor(l);for(let w=0,v=0;w<a;w++){let S=e.slice(v,v+p-l+(w<c?0:1));v+=S.length;const E=r.reedSolomonComputeRemainder(S,y);w<c&&S.push(0);f.push(S.concat(E))}let x=[];for(let w=0;w<f[0].length;w++)f.forEach((v,S)=>{(w!=p-l||S>=c)&&x.push(v[w])});return u(x.length==h),x}drawCodewords(e){if(e.length!=Math.floor(r.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let t=0;for(let i=this.size-1;i>=1;i-=2){i==6&&(i=5);for(let a=0;a<this.size;a++)for(let l=0;l<2;l++){const h=i-l,c=(i+1&2)==0,p=c?this.size-1-a:a;!this.isFunction[p][h]&&t<e.length*8&&(this.modules[p][h]=R(e[t>>>3],7-(t&7)),t++)}}u(t==e.length*8)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let i=0;i<this.size;i++){let a;switch(e){case 0:a=(i+t)%2==0;break;case 1:a=t%2==0;break;case 2:a=i%3==0;break;case 3:a=(i+t)%3==0;break;case 4:a=(Math.floor(i/3)+Math.floor(t/2))%2==0;break;case 5:a=i*t%2+i*t%3==0;break;case 6:a=(i*t%2+i*t%3)%2==0;break;case 7:a=((i+t)%2+i*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][i]&&a&&(this.modules[t][i]=!this.modules[t][i])}}getPenaltyScore(){let e=0;for(let a=0;a<this.size;a++){let l=!1,h=0,c=[0,0,0,0,0,0,0];for(let p=0;p<this.size;p++)this.modules[a][p]==l?(h++,h==5?e+=r.PENALTY_N1:h>5&&e++):(this.finderPenaltyAddHistory(h,c),l||(e+=this.finderPenaltyCountPatterns(c)*r.PENALTY_N3),l=this.modules[a][p],h=1);e+=this.finderPenaltyTerminateAndCount(l,h,c)*r.PENALTY_N3}for(let a=0;a<this.size;a++){let l=!1,h=0,c=[0,0,0,0,0,0,0];for(let p=0;p<this.size;p++)this.modules[p][a]==l?(h++,h==5?e+=r.PENALTY_N1:h>5&&e++):(this.finderPenaltyAddHistory(h,c),l||(e+=this.finderPenaltyCountPatterns(c)*r.PENALTY_N3),l=this.modules[p][a],h=1);e+=this.finderPenaltyTerminateAndCount(l,h,c)*r.PENALTY_N3}for(let a=0;a<this.size-1;a++)for(let l=0;l<this.size-1;l++){const h=this.modules[a][l];h==this.modules[a][l+1]&&h==this.modules[a+1][l]&&h==this.modules[a+1][l+1]&&(e+=r.PENALTY_N2)}let t=0;for(const a of this.modules)t=a.reduce((l,h)=>l+(h?1:0),t);const i=this.size*this.size,a=Math.ceil(Math.abs(t*20-i*10)/i)-1;return u(0<=a&&a<=9),e+=a*r.PENALTY_N4,u(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(this.version==1)return[];{const e=Math.floor(this.version/7)+2,t=Math.floor((this.version*8+e*3+5)/(e*4-4))*2;let i=[6];for(let a=this.size-7;i.length<e;a-=t)i.splice(1,0,a);return i}}static getNumRawDataModules(e){if(e<r.MIN_VERSION||e>r.MAX_VERSION)throw new RangeError("Version number out of range");let t=(16*e+128)*e+64;if(e>=2){const i=Math.floor(e/7)+2;t-=(25*i-10)*i-55;e>=7&&(t-=36)}return u(208<=t&&t<=29648),t}static getNumDataCodewords(e,t){return Math.floor(r.getNumRawDataModules(e)/8)-r.ECC_CODEWORDS_PER_BLOCK[t.ordinal][e]*r.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let t=[];for(let i=0;i<e-1;i++)t.push(0);t.push(1);let i=1;for(let a=0;a<e;a++){for(let l=0;l<t.length;l++)t[l]=r.reedSolomonMultiply(t[l],i),l+1<t.length&&(t[l]^=t[l+1]);i=r.reedSolomonMultiply(i,2)}return t}static reedSolomonComputeRemainder(e,t){let i=t.map(a=>0);for(const a of e){const l=a^i.shift();i.push(0);t.forEach((h,c)=>i[c]^=r.reedSolomonMultiply(h,l))}return i}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw new RangeError("Byte out of range");let i=0;for(let a=7;a>=0;a--)i=i<<1^(i>>>7)*285,i^=(t>>>a&1)*e;return u(i>>>8==0),i}finderPenaltyCountPatterns(e){const t=e[1];u(t<=this.size*3);const i=t>0&&e[2]==t&&e[3]==t*3&&e[4]==t&&e[5]==t;return(i&&e[0]>=t*4&&e[6]>=t?1:0)+(i&&e[6]>=t*4&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,i){return e&&(this.finderPenaltyAddHistory(t,i),t=0),t+=this.size,this.finderPenaltyAddHistory(t,i),this.finderPenaltyCountPatterns(i)}finderPenaltyAddHistory(e,t){t[0]==0&&(e+=this.size);t.pop();t.unshift(e)}};s(r,"MIN_VERSION",1);s(r,"MAX_VERSION",40);s(r,"PENALTY_N1",3);s(r,"PENALTY_N2",3);s(r,"PENALTY_N3",40);s(r,"PENALTY_N4",10);s(r,"ECC_CODEWORDS_PER_BLOCK",[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]]);s(r,"NUM_ERROR_CORRECTION_BLOCKS",[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]]);let QrCode=r;n.QrCode=r;function m(o,e,t){if(e<0||e>31||o>>>e!=0)throw new RangeError("Value out of range");for(let i=e-1;i>=0;i--)t.push(o>>>i&1)}function R(o,e){return(o>>>e&1)!=0}function u(o){if(!o)throw new Error("Assertion error")}const b=class b{constructor(e,t,i){this.mode=e;this.numChars=t;this.bitData=i;if(t<0)throw new RangeError("Invalid argument");this.bitData=i.slice()}static makeBytes(e){let t=[];for(const i of e)m(i,8,t);return new b(b.Mode.BYTE,e.length,t)}static makeNumeric(e){if(!b.isNumeric(e))throw new RangeError("String contains non-numeric characters");let t=[];for(let i=0;i<e.length;){const a=Math.min(e.length-i,3);m(parseInt(e.substring(i,i+a),10),a*3+1,t);i+=a}return new b(b.Mode.NUMERIC,e.length,t)}static makeAlphanumeric(e){if(!b.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let t=[],i;for(i=0;i+2<=e.length;i+=2){let a=b.ALPHANUMERIC_CHARSET.indexOf(e.charAt(i))*45;a+=b.ALPHANUMERIC_CHARSET.indexOf(e.charAt(i+1));m(a,11,t)}return i<e.length&&m(b.ALPHANUMERIC_CHARSET.indexOf(e.charAt(i)),6,t),new b(b.Mode.ALPHANUMERIC,e.length,t)}static makeSegments(e){return e==""?[]:b.isNumeric(e)?[b.makeNumeric(e)]:b.isAlphanumeric(e)?[b.makeAlphanumeric(e)]:[b.makeBytes(b.toUtf8ByteArray(e))]}static makeEci(e){let t=[];if(e<0)throw new RangeError("ECI assignment value out of range");else e<1<<7?m(e,8,t):e<1<<14?(m(2,2,t),m(e,14,t)):e<1e6?(m(6,3,t),m(e,21,t)):function(){throw new RangeError("ECI assignment value out of range")}();return new b(b.Mode.ECI,0,t)}static isNumeric(e){return b.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return b.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let i=0;for(const a of e){const l=a.mode.numCharCountBits(t);if(a.numChars>=1<<l)return 1/0;i+=4+l+a.bitData.length}return i}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let i=0;i<e.length;i++)e.charAt(i)!="%"?t.push(e.charCodeAt(i)):(t.push(parseInt(e.substring(i+1,i+3),16)),i+=2);return t}};s(b,"NUMERIC_REGEX",/^[0-9]*$/);s(b,"ALPHANUMERIC_REGEX",/^[A-Z0-9 $%*+.\/:-]*$/);s(b,"ALPHANUMERIC_CHARSET","0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:");let QrSegment=b;n.QrSegment=b})(qrcodegen||(qrcodegen={}));((n)=>{let QrCode;((r)=>{const b=class b{constructor(e,t){this.ordinal=e;this.formatBits=t}};s(b,"LOW",new b(0,1));s(b,"MEDIUM",new b(1,0));s(b,"QUARTILE",new b(2,3));s(b,"HIGH",new b(3,2));let Ecc=b;r.Ecc=b})(QrCode=n.QrCode||(n.QrCode={}))})(qrcodegen||(qrcodegen={}));((n)=>{let QrSegment;((r)=>{const b=class b{constructor(e,t){this.modeBits=e;this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};s(b,"NUMERIC",new b(1,[10,12,14]));s(b,"ALPHANUMERIC",new b(2,[9,11,13]));s(b,"BYTE",new b(4,[8,16,16]));s(b,"KANJI",new b(8,[8,10,12]));s(b,"ECI",new b(7,[0,0,0]));let Mode=b;r.Mode=b})(QrSegment=n.QrSegment||(n.QrSegment={}))})(qrcodegen||(qrcodegen={}));return qrcodegen})();

  // Thin wrapper to match app's expected interface
  const QR = {
    generate(text) {
      const qr = qrcodegen.QrCode.encodeText(text, qrcodegen.QrCode.Ecc.MEDIUM);
      // Convert to 2D array of 0/1 for canvas rendering
      const modules = [];
      for (let y = 0; y < qr.size; y++) {
        const row = [];
        for (let x = 0; x < qr.size; x++)
          row.push(qr.getModule(x, y) ? 1 : 0);
        modules.push(row);
      }
      return { modules, size: qr.size };
    }
  };

  // ── APP ──
  const QR_SIZE = 512;
  const urlInput = document.getElementById('urlInput');
  const btnGenerate = document.getElementById('btnGenerate');
  const outputSection = document.getElementById('outputSection');
  const qrUrlDisplay = document.getElementById('qrUrlDisplay');
  const colorPicker = document.getElementById('colorPicker');
  const colorHex = document.getElementById('colorHex');
  const qrCanvas = document.getElementById('qrCanvas');
  const qrPreview = document.getElementById('qrPreview');
  const ctx = qrCanvas.getContext('2d');

  let currentUrl = '';
  let currentColor = '#000000';
  let currentModules = null;

  colorPicker.addEventListener('input', (e) => {
    colorHex.textContent = e.target.value.toUpperCase();
    currentColor = e.target.value;
    if (currentModules) renderQR(currentModules, currentColor);
  });

  urlInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') btnGenerate.click(); });
  urlInput.focus();

  btnGenerate.addEventListener('click', () => {
    let url = urlInput.value.trim();
    if (!url) { showToast('Paste a URL first!'); urlInput.focus(); return; }
    if (!/^https?:\/\//i.test(url)) { url = 'https://' + url; urlInput.value = url; }
    currentUrl = url;
    try {
      currentModules = QR.generate(url);
      renderQR(currentModules, currentColor);
      qrUrlDisplay.textContent = url;
      outputSection.classList.add('visible');
      setTimeout(() => outputSection.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
    } catch (e) { showToast('URL too long — try a shorter one'); }
  });

  function drawToCanvas(canvas, { modules, size: qrSize }, color, transparent) {
    canvas.width = QR_SIZE;
    canvas.height = QR_SIZE;
    const c = canvas.getContext('2d');
    const scale = QR_SIZE / (qrSize + 8);
    if (transparent) c.clearRect(0, 0, QR_SIZE, QR_SIZE);
    else { c.fillStyle = '#ffffff'; c.fillRect(0, 0, QR_SIZE, QR_SIZE); }
    c.fillStyle = color;
    for (let y = 0; y < qrSize; y++)
      for (let x = 0; x < qrSize; x++)
        if (modules[y][x])
          c.fillRect(Math.round((x + 4) * scale), Math.round((y + 4) * scale), Math.ceil(scale), Math.ceil(scale));
  }

  function renderQR(qrData, color) {
    drawToCanvas(qrCanvas, qrData, color, false);
    qrPreview.src = qrCanvas.toDataURL('image/png');
  }

  function downloadFile(canvas, suffix) {
    const slug = currentUrl.replace(/https?:\/\//, '').replace(/[^a-z0-9]/gi, '-').substring(0, 30);
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'qrdiggy-' + slug + suffix + '.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  document.getElementById('btnDownloadPng').addEventListener('click', () => {
    if (!currentModules) return;
    drawToCanvas(qrCanvas, currentModules, currentColor, false);
    downloadFile(qrCanvas, '');
    showToast('PNG downloaded!');
  });

  document.getElementById('btnDownloadTransparent').addEventListener('click', () => {
    if (!currentModules) return;
    const tmp = document.createElement('canvas');
    drawToCanvas(tmp, currentModules, currentColor, true);
    downloadFile(tmp, '-transparent');
    showToast('Transparent PNG downloaded!');
  });

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
  }
</script>

</body>
</html>
